schemaVersion: 2.2.2
metadata:
  name: konveyor-kai-coolstore
components:
  - name: tools
    container:
      image: quay.io/devfile/universal-developer-image:ubi8-latest
      memoryLimit: "2Gi"
      memoryRequest: "1Gi"
      cpuLimit: "1"
      cpuRequest: "500m"
      mountSources: true
      sourceMapping: /projects
      endpoints:
        - exposure: public
          name: frontend
          protocol: https
          targetPort: 3000
        - exposure: public
          name: backend
          protocol: https
          targetPort: 8080
      env:
        - name: PYTHON_VERSION
          value: "3.11"
      args:
        - tail
        - -f
        - /dev/null
      volumeMounts:
        - name: npm
          path: /home/user/.npm

  - name: npm
    volume:
      size: 1G

projects:
  - name: coolstore
    git:
      remotes:
        origin: https://github.com/rrbanda/coolstore.git
      checkoutFrom:
        revision: main

commands:
  - id: install-frontend
    exec:
      label: "Download frontend dependencies"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/web-app
      commandLine: "npm install"
      group:
        kind: build

  - id: run-frontend
    exec:
      label: "Run the frontend app"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/web-app
      commandLine: "npm run dev"
      group:
        kind: run

  - id: build-backend
    exec:
      label: "Build backend (Catalog Service)"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/services/catalog
      commandLine: "mvn clean install"
      group:
        kind: build

  - id: run-backend
    exec:
      label: "Run backend (Catalog Service)"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/services/catalog
      commandLine: "mvn quarkus:dev"
      group:
        kind: run
