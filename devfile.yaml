schemaVersion: 2.2.2
metadata:
  name: konveyor-kai-coolstore
  version: 1.0.0
  description: Explore the Coolstore app with Konveyor Kai in Dev Spaces
  tags: [java, nodejs, quarkus, frontend, backend]

components:
  - name: tools
    container:
      image: quay.io/devfile/universal-developer-image:ubi9-latest
      memoryLimit: 2Gi
      memoryRequest: 1Gi
      cpuLimit: "1"
      cpuRequest: "500m"
      mountSources: true
      sourceMapping: /projects
      env:
        - name: PYTHON_VERSION
          value: "3.11"
      args:
        - tail
        - -f
        - /dev/null
      volumeMounts:
        - name: npm
          path: /home/user/.npm
      endpoints:
        - name: frontend
          targetPort: 3000
          protocol: https
          exposure: public
        - name: backend
          targetPort: 8080
          protocol: https
          exposure: public

  - name: npm
    volume:
      size: 1Gi

projects:
  - name: coolstore
    git:
      remotes:
        origin: https://github.com/rrbanda/coolstore.git
      checkoutFrom:
        revision: main

commands:
  - id: install-frontend
    exec:
      label: "Install frontend dependencies"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/web-app
      commandLine: "npm install"
      group:
        kind: build

  - id: run-frontend
    exec:
      label: "Run frontend app"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/web-app
      commandLine: "npm run dev"
      group:
        kind: run

  - id: build-backend
    exec:
      label: "Build backend (Catalog Service)"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/services/catalog
      commandLine: "mvn clean install"
      group:
        kind: build

  - id: run-backend
    exec:
      label: "Run backend (Catalog Service)"
      component: tools
      workingDir: ${PROJECTS_ROOT}/coolstore/services/catalog
      commandLine: "mvn quarkus:dev"
      group:
        kind: run
